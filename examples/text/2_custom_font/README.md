# Lesson 2: Custom Font

Create your own font and use the asset pipeline.

## Learning Objectives

After this lesson, you will understand:
- ✅ The asset conversion pipeline
- ✅ How to use the `font2snes` tool
- ✅ Full ASCII character support (32-127)
- ✅ Organizing assets in your project

## Prerequisites

- Completed [1. Hello World](../1_hello_world/)
- An image editor (any that saves PNG)

---

## The Problem with Inline Fonts

In Hello World, we defined fonts directly in code:

```c
static const u8 font_1bpp[] = {
    0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00,  /* H */
    /* ... 100+ more lines ... */
};
```

This works, but:
- ❌ Hard to edit
- ❌ Can't visualize easily
- ❌ Error-prone
- ❌ Doesn't scale

## The Solution: Asset Pipeline

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  myfont.png │ ──▶ │  font2snes  │ ──▶ │  myfont.h   │
│  (artwork)  │     │   (tool)    │     │  (C header) │
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
                                        ┌─────────────┐
                                        │   main.c    │
                                        │ #include    │
                                        └─────────────┘
```

Now you can:
- ✅ Edit fonts visually
- ✅ Use any image editor
- ✅ Regenerate with one command
- ✅ Version control the source PNG

---

## Creating a Font Image

### Layout Requirements

The `font2snes` tool expects:
- **Dimensions:** Multiples of 8 pixels
- **Character size:** 8×8 pixels each
- **Characters:** ASCII 32-127 (96 total)
- **Recommended layout:** 128×48 pixels (16×6 grid)

```
Row 0: SP ! " # $ % & ' ( ) * + , - . /   (ASCII 32-47)
Row 1: 0 1 2 3 4 5 6 7 8 9 : ; < = > ?    (ASCII 48-63)
Row 2: @ A B C D E F G H I J K L M N O    (ASCII 64-79)
Row 3: P Q R S T U V W X Y Z [ \ ] ^ _    (ASCII 80-95)
Row 4: ` a b c d e f g h i j k l m n o    (ASCII 96-111)
Row 5: p q r s t u v w x y z { | } ~ DEL  (ASCII 112-127)
```

### Color Limits

For 2bpp (text): **4 colors maximum**
```
Color 0: Background (transparent)
Color 1: Text color
Color 2: Shadow/outline (optional)
Color 3: Highlight (optional)
```

---

## Using font2snes

### Basic Usage

```bash
# Convert PNG to C header
font2snes -c assets/myfont.png myfont.h

# Specify bits per pixel
font2snes -b 2 -c assets/myfont.png myfont.h  # 2bpp (4 colors)
font2snes -b 4 -c assets/myfont.png myfont.h  # 4bpp (16 colors)
```

### Generated Header

```c
/* myfont.h - Generated by font2snes */

const unsigned short myfont_pal[4] = {
    0x0000, 0x7FFF, 0x294A, 0x0000
};

const unsigned char myfont_tiles[1536] = {
    /* Tile 0 (space) */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    /* Tile 1 (!) */
    /* ... */
};

#define myfont_TILES_COUNT 96
#define myfont_TILES_SIZE 1536
#define myfont_PAL_COUNT 4
```

---

## Project Structure

```
2_custom_font/
├── assets/
│   └── myfont.png      # Source artwork
├── main.c              # Your code
├── myfont.h            # Generated (don't edit!)
├── crt0.asm
├── hdr.asm
└── Makefile
```

### Makefile Integration

```makefile
# Generate header from PNG (automatic)
myfont.h: assets/myfont.png
    $(FONT2SNES) -c $< $@

# main.c depends on the header
main.ps: main.c myfont.h
    $(CC) $(CFLAGS) -c main.c -o $@
```

---

## Using the Font in Code

```c
#include "myfont.h"

/* Load tiles to VRAM */
void load_font(void) {
    u16 i;

    REG_VMAIN = 0x80;
    REG_VMADDL = 0x00;
    REG_VMADDH = 0x00;

    for (i = 0; i < myfont_TILES_SIZE; i += 2) {
        REG_VMDATAL = myfont_tiles[i];
        REG_VMDATAH = myfont_tiles[i + 1];
    }
}

/* Load palette to CGRAM */
void load_palette(void) {
    u8 i;

    REG_CGADD = 0;
    for (i = 0; i < myfont_PAL_COUNT; i++) {
        REG_CGDATA = myfont_pal[i] & 0xFF;
        REG_CGDATA = myfont_pal[i] >> 8;
    }
}

/* Convert ASCII to tile number */
u8 ascii_to_tile(char c) {
    if (c < 32 || c > 127) return 0;  /* Space for invalid */
    return c - 32;  /* ASCII 32 = tile 0, etc. */
}
```

---

## Build and Run

```bash
cd examples/text/2_custom_font
make clean && make

# The Makefile automatically runs font2snes
```

---

## Exercises

### Exercise 1: Create Your Own Font
1. Open `assets/myfont.png` in an image editor
2. Modify some letters
3. Run `make clean && make`
4. Test in emulator

### Exercise 2: Add Special Characters
Modify the font to include custom symbols (arrows, hearts, etc.) in the unused positions.

### Exercise 3: Different Font Styles
Create a second font with different styling (bold, outline) and switch between them.

---

## Common Issues

### "Too many colors"
Your PNG has more than 4 colors. Reduce the palette in your image editor.

### Characters look wrong
Check that your grid is exactly 8×8 per character and the layout matches the expected ASCII positions.

### Build fails with "myfont.h not found"
Make sure `assets/myfont.png` exists and the path is correct.

---

## Files in This Example

| File | Purpose |
|------|---------|
| `main.c` | Display logic |
| `assets/myfont.png` | Font artwork (edit this!) |
| `myfont.h` | Generated (don't edit) |
| `Makefile` | Build + asset conversion |

---

## What's Next?

Now that you understand the asset pipeline, let's apply it to graphics:
- Convert sprite images
- Display moving characters
- Handle player input

**Next Topic:** [Graphics](../../graphics/) →
